<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Castellana Wagen M-40 | Volkswagen</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#001E50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --vw-blue: #001E50; --vw-light: #00B0F0; --glass: rgba(20, 30, 60, 0.85);
            --glass-border: rgba(255, 255, 255, 0.15); --renting-alert: #ff9800; --success: #25D366;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        ::-webkit-scrollbar { display: none; }
        input, textarea { -webkit-user-select: text !important; user-select: text !important; font-family: inherit; }

        body {
            margin: 0; padding: 0; background: #000; color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: radial-gradient(circle at 50% 50%, #1a3a60 0%, #000510 80%);
            background-size: 150% 150%;
            animation: bgBreath 10s ease-in-out infinite alternate;
            background-attachment: fixed;
        }
        @keyframes bgBreath { 0% { background-position: 30% 30%; } 100% { background-position: 70% 70%; } }

        .app-container { width: 100%; max-width: 450px; margin: 0 auto; padding-bottom: 120px; min-height: 100vh; position: relative; }
        .screen { display: none; flex-direction: column; padding: 25px; animation: fadeIn 0.4s ease-out; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .welcome-header { text-align: center; margin-top: 50px; margin-bottom: 30px; }
        .welcome-header h1 { font-weight: 100; font-size: 26px; line-height: 1.2; }
        .welcome-header h1 b { font-weight: 800; display: block; font-size: 32px; margin-top: 5px; }
        .welcome-header p { font-size: 14px; opacity: 0.7; margin-top: 15px; font-weight: 300; }

        #s-splash { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; justify-content:center; align-items:center; }
        .splash-logo { width: 100px; animation: pulse 2.5s infinite; filter: brightness(0) invert(1) !important; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .logo-white { filter: brightness(0) invert(1) !important; }

        .section-title { font-size: 11px; font-weight: 800; color: rgba(255,255,255,0.6); letter-spacing: 1.5px; margin: 30px 0 10px 0; text-transform: uppercase; }

        .bento { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .tile { background: var(--glass); padding: 20px; border-radius: 22px; display: flex; flex-direction: column; gap: 10px; border: 1px solid var(--glass-border); cursor: pointer; transition: 0.2s; }
        .tile.wide { grid-column: span 2; flex-direction: row; align-items: center; justify-content: space-between; }
        .icon-box { width: 42px; height: 42px; background: rgba(0, 176, 240, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--vw-light); }

        .status-box { background: var(--glass); padding: 25px; border-radius: 25px; margin-bottom: 25px; border: 1px solid var(--glass-border); text-align: center; }
        .timer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; }
        .time-unit div:first-child { font-size: 22px; font-weight: 800; color: var(--vw-light); font-variant-numeric: tabular-nums; }
        .time-unit div:last-child { font-size: 9px; opacity: 0.6; font-weight: 600; text-transform: uppercase; }

        .reveal-container { position: relative; width: 100%; height: 320px; border-radius: 35px; overflow: hidden; margin-bottom: 25px; background: radial-gradient(circle at center 80%, #2a4a70 0%, #000000 70%); border: 1px solid var(--glass-border); display: flex; align-items: flex-end; justify-content: center; padding-bottom: 30px; }
        .car-photo { width: 100%; height: auto; object-fit: contain; z-index: 3; transition: 1.2s ease-out; -webkit-box-reflect: below -25px linear-gradient(transparent, transparent 60%, rgba(255,255,255,0.15)); }
        .blue-cover { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg, #001e50 0%, #0044a0 50%, #001e50 100%); z-index: 6; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: transform 1.2s cubic-bezier(0.45, 0.05, 0.55, 0.95), opacity 0.8s ease; cursor: pointer; box-shadow: inset 0 0 100px rgba(0,0,0,0.5); }
        .blue-cover.open { transform: translateY(-110%) skewY(-5deg); opacity: 0; }

        .btn-glow { background: linear-gradient(135deg, #00B0F0, #006090); color: white; border: none; padding: 18px; border-radius: 50px; font-weight: 700; width: 100%; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 13px; margin-top: 10px; }
        .btn-checkin { background: linear-gradient(135deg, #11998e, #38ef7d); color: #000; border: none; padding: 18px; border-radius: 50px; font-weight: 800; width: 100%; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }

        .review-card { margin-top: 30px; padding: 25px; border-radius: 25px; text-align: center; background: var(--glass); border: 1px solid var(--glass-border); }
        .review-btn { background: white; color: black; border: none; padding: 14px 28px; border-radius: 50px; font-size: 12px; font-weight: 800; cursor: pointer; margin-top: 15px; display: inline-flex; align-items: center; gap: 8px; text-transform: uppercase; }

        .checklist-group { margin-bottom: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 25px; border: 1px solid var(--glass-border); }
        .checklist-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--glass); border-radius: 16px; margin-bottom: 10px; border: 1px solid var(--glass-border); cursor: pointer; }
        .check-circle { width: 22px; height: 22px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; }
        .checklist-item.checked .check-circle { background: var(--success); border-color: var(--success); color: white; }
        
        .faq-item { background: var(--glass); border-radius: 18px; margin-bottom: 10px; border: 1px solid var(--glass-border); overflow: hidden; }
        .faq-head { padding: 18px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; font-weight: 700; cursor: pointer; }
        .faq-body { padding: 0 18px 18px 18px; font-size: 12px; opacity: 0.8; display: none; line-height: 1.4; }
        .faq-item.open .faq-body { display: block; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-item { background: var(--glass); padding: 15px; border-radius: 18px; text-align: center; border: 1px solid var(--glass-border); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; cursor: pointer; }
        .grid-item i { font-size: 24px; }
        .w-orange { color: #ff9800; } .w-red { color: #ff4444; } .w-blue { color: var(--vw-light); }
        
        .dealer-hero { width: 110%; height: 220px; margin-left: -5%; margin-top: -25px; margin-bottom: 25px; object-fit: cover; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .pdf-viewer { width: 100%; height: 450px; border-radius: 25px; border: 1px solid var(--glass-border); background: white; margin-bottom: 15px; }
        .reset-btn { position: fixed; top: 15px; right: 15px; font-size: 10px; opacity: 0.5; background: rgba(0,0,0,0.5); padding: 8px 12px; border-radius: 20px; z-index: 10000; color: white; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); }
        #toast { visibility: hidden; min-width: 250px; background-color: white; color: black; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 9999; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 13px; font-weight: 600; opacity: 0; transition: 0.3s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="reset-btn" onclick="localStorage.clear(); location.reload();">RESET APP</div>
    
    <div id="s-splash">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg" class="splash-logo">
    </div>

    <section id="s-welcome" class="screen">
        <div class="welcome-header">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg" width="60" class="logo-white">
            <h1>Bienvenido a <b>Castellana Wagen M-40</b></h1>
            <p>Tu herramienta digital de entrega personalizada.</p>
        </div>
        <div style="background:var(--glass); padding:30px; border-radius:30px; border:1px solid var(--glass-border); margin-top:20px;">
            <button class="btn-glow" onclick="window.open('https://outlook.office.com/book/EntregasVWMadrid@porscheholding.onmicrosoft.com/'); navTo('s-login')">üìÖ RESERVAR CITA ENTREGA</button>
            <button class="btn-glow" style="background:transparent; border:1px solid white; margin-top:15px;" onclick="navTo('s-login')">YA TENGO MI CITA</button>
        </div>
    </section>

    <section id="s-login" class="screen">
        <div style="text-align:center; margin-top:60px;">
            <i class="fas fa-arrow-left" onclick="navTo('s-welcome')" style="float:left; font-size:20px;"></i>
            <h2 style="font-weight:200;">Acceso Clientes</h2>
            <p style="opacity:0.6; font-size:12px; margin-bottom:20px;">INTRODUCE TU MATR√çCULA</p>
            <input type="text" id="username" placeholder="0000 XXX" style="width:100%; padding:18px; background:rgba(255,255,255,0.1); border:1px solid var(--glass-border); border-radius:15px; color:white; text-align:center; font-size:22px; font-weight:800; outline:none; text-transform:uppercase;">
            <button class="btn-glow" style="margin-top:20px;" onclick="doLogin()">ACCEDER</button>
        </div>
    </section>

    <section id="s-transition" class="screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle at 50% 50%, #1a3a60 0%, #000510 80%); z-index:2000; justify-content:center; align-items:center; text-align:center;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg" width="60" class="logo-white pulse-logo">
        <div style="font-size:20px; margin-top:30px; font-weight: 200; letter-spacing: 1px;">Preparando tu entrega...</div>
        <span id="trans-name" style="font-size:32px; font-weight:800; color:white; margin-top:10px;"></span>
    </section>

    <section id="s-dash" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <div><span style="opacity:0.6; font-size:12px;">HOLA,</span><div id="dash-name" style="font-size:24px; font-weight:800;">Conductor</div></div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg" width="35" class="logo-white">
        </div>
        <div id="status-widget" class="status-box"></div>
        <div class="reveal-container" id="car-stage" onclick="reveal()">
            <div class="blue-cover" id="cover">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6d/Volkswagen_logo_2019.svg" width="45" class="logo-white" style="margin-bottom:10px;">
                <h2 style="font-weight:200; margin:0;">TU NUEVO <span id="cover-car-name" style="font-weight:900;">VW</span></h2>
                <div style="font-size:10px; opacity:0.8; margin-top:10px; letter-spacing:2px; font-weight:700;">TOCA PARA RETIRAR LA LONA</div>
            </div>
            <img id="real-car-img" class="car-photo" src="">
        </div>
        <button class="btn-checkin" onclick="notifyArrival()"><i class="fas fa-map-marker-alt"></i> YA ESTOY AQU√ç</button>
        <div class="section-title">MEN√ö PRINCIPAL</div>
        <div class="bento">
            <div class="tile wide" onclick="whatsappMe()">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div id="agent-avatar" style="width:50px; height:50px; background:var(--vw-blue); border-radius:50%; display:flex; align-items:center; justify-content:center; border:2px solid var(--vw-light); font-weight:bold;">VW</div>
                    <div><div id="agent-name" style="font-size:16px; font-weight:bold;">Asesor</div><div style="font-size:12px; opacity:0.6;">Tu Asesor de Entregas</div></div>
                </div><i class="fab fa-whatsapp" style="color:#25D366; font-size:32px;"></i>
            </div>
            <div class="tile wide" style="background: linear-gradient(135deg, rgba(0, 30, 80, 0.9), rgba(0,0,0,0.5));" onclick="navTo('s-video')">
                <div><strong>Tu Coche al Detalle</strong><br><span style="font-size:11px; opacity:0.7;">Video Gu√≠a Interactiva</span></div><i class="fas fa-play-circle" style="font-size:35px;"></i>
            </div>
            <div class="tile" onclick="navTo('s-services')"><div class="icon-box"><i class="fas fa-life-ring"></i></div><span>Asistencia</span></div>
            <div class="tile" onclick="navTo('s-checklist')"><div class="icon-box"><i class="fas fa-clipboard-check"></i></div><span>Entrega</span></div>
            <div class="tile" onclick="navTo('s-shop')"><div class="icon-box"><i class="fas fa-shopping-bag"></i></div><span>Accesorios</span></div>
            <div class="tile" onclick="navTo('s-dealership')"><div class="icon-box"><i class="fas fa-map-marker-alt"></i></div><span>Concesionario</span></div>
        </div>
        <div class="review-card">
            <h4 style="margin:0; font-size:18px;">¬øQu√© tal tu experiencia?</h4>
            <div style="color: #FFD700; font-size: 20px; margin: 10px 0;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
            <button class="review-btn" onclick="window.open('https://search.google.com/local/writereview?placeid=ChIJc6vL3fIvQg0RGT8iQzPAenc')">VALORAR EN GOOGLE</button>
        </div>
        <div style="text-align:center; padding:40px 0; opacity:0.4; font-size:10px; letter-spacing:1px;">
            Manuel Arjona Carrera ¬© 2026<br>CASTELLANA WAGEN M-40
        </div>
    </section>

    <section id="s-services" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;"><i class="fas fa-arrow-left" onclick="navTo('s-dash')"></i><span style="font-weight:800; font-size:18px;">ASISTENCIA</span></div>
        <div onclick="window.open('tel:900100238')" style="background:rgba(255,68,68,0.1); padding:20px; border-radius:25px; display:flex; align-items:center; gap:15px; border:1px solid rgba(255,68,68,0.2); margin-bottom:15px;">
            <i class="fas fa-phone-alt" style="color:#ff4444; font-size:24px;"></i><div><div style="font-weight:bold;">Emergencia 24h</div><div style="font-size:12px; opacity:0.8;">900 100 238 (VW Service)</div></div>
        </div>
        <div style="background:rgba(255,152,0,0.05); padding:15px; border-radius:15px; border:1px dashed var(--renting-alert); font-size:12px; color:#ccc; line-height:1.5; margin-bottom:25px;">
            <i class="fas fa-info-circle" style="color:var(--renting-alert);"></i> <strong>Aviso Renting:</strong> Consulta si tu operador requiere llamar a su propio n√∫mero de gr√∫a.
        </div>
        <div class="section-title">TESTIGOS DE ALERTA</div>
        <div class="grid-2">
            <div class="grid-item" onclick="showToast('Pare motor inmediatamente.')"><i class="fas fa-triangle-exclamation w-red"></i><span>Aver√≠a</span></div>
            <div class="grid-item" onclick="showToast('Revise nivel de aceite.')"><i class="fas fa-oil-can w-orange"></i><span>Aceite</span></div>
            <div class="grid-item" onclick="showToast('Verifique presi√≥n neum√°ticos.')"><i class="fas fa-gauge-high w-orange"></i><span>Presi√≥n</span></div>
            <div class="grid-item" onclick="showToast('Rellene AdBlue (m√≠nimo 5L).')"><i class="fas fa-gas-pump w-blue"></i><span>AdBlue</span></div>
        </div>
        <div class="section-title">FAQs</div>
        <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-head"><span>üíß ¬øCu√°ndo echar AdBlue?</span><i class="fas fa-chevron-down"></i></div><div class="faq-body">El coche avisa con 2.400km de antelaci√≥n. Rellena m√≠nimo 5L. Si llega a 0km no arrancar√°.</div></div>
        <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-head"><span>üîò Resetear Neum√°ticos</span><i class="fas fa-chevron-down"></i></div><div class="faq-body">Tras inflar las ruedas, ve a la pantalla: Veh√≠culo > Estado > Neum√°ticos > SET.</div></div>
        <div class="section-title">TALLER Y POSVENTA</div>
        <div style="background:var(--glass); padding:20px; border-radius:25px; border:1px solid var(--glass-border);">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;"><div style="width:45px; height:45px; background:var(--vw-blue); border-radius:50%; display:flex; align-items:center; justify-content:center; border:2px solid var(--vw-light); font-weight:bold;">AB</div><div><div style="font-weight:bold;">√Ålvaro Beltr√°n</div><div style="font-size:12px; opacity:0.6;">Cita Taller / Posventa</div></div></div>
            <div style="display:flex; gap:10px;">
                <button class="btn-glow" style="flex:1; padding:10px; font-size:11px; background:rgba(255,255,255,0.05);" onclick="window.open('tel:648006146')">Llamar</button>
                <button class="btn-glow" style="flex:1; padding:10px; font-size:11px; background:rgba(255,255,255,0.05);" onclick="window.open('mailto:alvaro.beltran@vwmadrid.es')">Email</button>
            </div>
        </div>
    </section>

    <section id="s-checklist" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;"><i class="fas fa-arrow-left" onclick="navTo('s-dash')"></i><span style="font-weight:800; font-size:18px;">ENTREGA</span></div>
        <video width="100%" controls style="border-radius:25px; margin-bottom:25px; border:1px solid var(--glass-border);"><source src="https://raw.githubusercontent.com/vwmadrid/Entregas/main/Conexion.mp4" type="video/mp4"></video>
        <div class="checklist-group">
            <div class="section-title" style="margin-top:0;">AL RECOGER TU VW</div>
            <div class="checklist-item" onclick="toggleCheck(this)"><div>DNI Original</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
            <div class="checklist-item" onclick="toggleCheck(this)"><div>App We Connect</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
            <div class="checklist-item" style="border-left:4px solid var(--renting-alert);" onclick="toggleCheck(this)"><div>Autorizaci√≥n Empresa</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
        </div>
        <div class="checklist-group" style="border-color:rgba(255,152,0,0.2);">
            <div class="section-title" style="margin-top:0; color:var(--renting-alert);">AL ENTREGAR ANTIGUO (RENTING)</div>
            <div class="checklist-item" onclick="toggleCheck(this)"><div>2¬™ Llave y Papeles</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
            <div class="checklist-item" onclick="toggleCheck(this)"><div>Mando garaje / SD / Gafas</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
            <div class="checklist-item" onclick="toggleCheck(this)"><div>Fotos Estado (Seguridad)</div><div class="check-circle"><i class="fas fa-check"></i></div></div>
        </div>
        <button id="notifyBtn" class="btn-glow" onclick="notifyChecklist()">TODO LISTO PARA LA ENTREGA</button>
    </section>

    <section id="s-shop" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;"><i class="fas fa-arrow-left" onclick="navTo('s-dash')"></i><span style="font-weight:800; font-size:18px;">ACCESORIOS</span></div>
        <div class="section-title">LOS M√ÅS VENDIDOS</div>
        <div class="grid-2" style="margin-bottom:20px;">
            <div class="grid-item"><i class="fas fa-charging-station w-blue"></i><span>Cables</span></div>
            <div class="grid-item"><i class="fas fa-shoe-prints" style="color:#aaa;"></i><span>Alfombrillas</span></div>
            <div class="grid-item"><i class="fas fa-suitcase" style="color:#aaa;"></i><span>Maletero</span></div>
            <div class="grid-item"><i class="fas fa-bicycle" style="color:#aaa;"></i><span>Portabicis</span></div>
        </div>
        <iframe src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/vwmadrid/Entregas/main/catalogo.pdf&embedded=true" class="pdf-viewer"></iframe>
        <textarea id="wishlist" style="width:100%; margin-top:10px; background:var(--glass); color:white; border-radius:15px; padding:15px; border:1px solid var(--glass-border); outline:none;" placeholder="¬øBuscas alg√∫n accesorio espec√≠fico?"></textarea>
        <button class="btn-glow" style="background:#25D366; margin-top:15px;" onclick="sendWishlist()">CONSULTAR POR WHATSAPP</button>
    </section>

    <section id="s-dealership" class="screen" style="padding-top:0;">
        <div class="dealer-hero"><img src="https://raw.githubusercontent.com/vwmadrid/Entregas/main/images/concesionario.jpg" style="width:100%; height:100%; object-fit:cover;" onerror="this.src='https://via.placeholder.com/400x200/001E50/FFFFFF?text=Castellana+Wagen';"><i class="fas fa-arrow-left" onclick="navTo('s-dash')" style="position:absolute; top:30px; left:25px; font-size:22px; color:white; text-shadow:0 2px 10px black;"></i></div>
        <div style="padding:0 15px; text-align:center;">
            <h3 style="font-size:28px; margin:0 0 5px 0;">Castellana Wagen M-40</h3>
            <p style="opacity:0.7; font-size:14px; margin-bottom:25px;">Calle de Sof√≠a, 18, 28022 Madrid</p>
            <div class="tile wide" style="margin-bottom:10px;" onclick="window.open('tel:913136450')"><div style="display:flex; align-items:center; gap:15px;"><i class="fas fa-phone"></i><span>913 13 64 50</span></div></div>
            <div class="tile wide" style="margin-bottom:25px;" onclick="window.open('https://www.volkswagenmadrid.es')"><div style="display:flex; align-items:center; gap:15px;"><i class="fas fa-globe"></i><span>volkswagenmadrid.es</span></div></div>
            <button class="btn-glow" onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=Castellana+Wagen+M40')">üöÄ C√ìMO LLEGAR (GPS)</button>
        </div>
    </section>

    <section id="s-video" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;"><i class="fas fa-arrow-left" onclick="navTo('s-dash')"></i><span style="font-weight:800; font-size:18px;">TU COCHE</span></div>
        <iframe id="video-frame" width="100%" height="220" src="" frameborder="0" allowfullscreen style="border-radius:25px; border:1px solid var(--glass-border);"></iframe>
        <div class="section-title">TECNOLOG√çA A BORDO</div>
        <div class="grid-2">
            <div class="grid-item" onclick="showToast('Cuadro digital 100% personalizable.')"><i class="fas fa-tachometer-alt" style="color:var(--vw-light);"></i><span>Cockpit</span></div>
            <div class="grid-item" onclick="showToast('Conecta tu m√≥vil inal√°mbricamente.')"><i class="fab fa-bluetooth-b" style="color:var(--vw-light);"></i><span>App Connect</span></div>
            <div class="grid-item" onclick="showToast('Asistentes de conducci√≥n activa.')"><i class="fas fa-shield-alt" style="color:var(--vw-light);"></i><span>IQ.Drive</span></div>
            <div class="grid-item" onclick="showToast('El coche aparca solo por ti.')"><i class="fas fa-parking" style="color:var(--vw-light);"></i><span>Park Assist</span></div>
        </div>
        <button class="btn-glow" style="margin-top:20px; background:rgba(255,255,255,0.1); border:1px solid #444;" onclick="window.open('https://www.volkswagen.es/es/clientes/informacion-sobre-tu-coche/manuales.html')">üìö MANUAL DIGITAL OFICIAL</button>
    </section>

    <div id="toast"></div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbz2zrLTCpCPaWvBnk85hD22kuVh1NeHmm-3mthc9GRFvus-MnqEYU7P-pWiHF2E1G0I/exec";

    const cars = [
        {name: "Golf", file: "Golf.png", vid: "X5pVXMkeZbc"}, {name: "Tiguan", file: "Tiguan.png", vid: "mq40yhpczSw"}, {name: "T-Roc", file: "T-Roc.png", vid: "M-i8eaJV69U"}, {name: "Polo", file: "Polo.png", vid: "CZyF4WThT3I"}, {name: "Taigo", file: "Taigo.png", vid: "zdDoaMYpFxc"}, {name: "Caddy", file: "Caddy.png", vid: "u6Qugt8u9kg"}, {name: "ID. Buzz", file: "ID. Buzz.png", vid: "GlzLdbJMuAQ"}
    ];

    let user = null;
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showToast("Pulsa aqu√≠ para instalar como App", 5000);
    });

    window.onpopstate = function() {
        if (user) { navTo('s-dash'); } else { navTo('s-welcome'); }
    };

    window.onload = function() {
        if(!localStorage.getItem('app_final_fixed_v9')) { localStorage.clear(); localStorage.setItem('app_final_fixed_v9', 'true'); }
        setTimeout(() => document.getElementById('s-splash').style.display = 'none', 2000);
        const saved = localStorage.getItem('vw_user_data');
        if(saved) { user = JSON.parse(saved); loadDash(); } else { navTo('s-welcome'); }
    };

    function navTo(id) { 
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
        window.scrollTo(0,0);
        history.pushState(null, null, null);
    }

    function doLogin() {
        var mat = document.getElementById('username').value.trim().toUpperCase();
        if(mat.length < 3) return;
        document.querySelector('#s-login .btn-glow').innerText = "VERIFICANDO...";
        fetch(API_URL + "?matricula=" + mat)
            .then(res => res.json())
            .then(data => {
                if(data.encontrado) {
                    var car = cars.find(c => data.modelo.toUpperCase().includes(c.name.toUpperCase())) || cars[2];
                    user = { name: data.cliente, car: car, deliveryDate: data.fecha, agente: data.agente };
                    localStorage.setItem('vw_user_data', JSON.stringify(user));
                    document.getElementById('trans-name').innerText = user.name.toUpperCase();
                    navTo('s-transition');
                    setTimeout(loadDash, 2000);
                } else { alert("Matr√≠cula no encontrada"); document.querySelector('#s-login .btn-glow').innerText = "ACCEDER"; }
            });
    }

    function loadDash() {
        navTo('s-dash');
        document.getElementById('dash-name').innerText = user.name.split(' ')[0];
        document.getElementById('real-car-img').src = "https://raw.githubusercontent.com/vwmadrid/Entregas/main/images/" + user.car.file;
        document.getElementById('video-frame').src = "https://www.youtube.com/embed/" + user.car.vid;
        var esAle = user.agente && user.agente.includes("ALEJANDRO");
        document.getElementById('agent-name').innerText = esAle ? "Alejandro Martos" : "Manuel Arjona";
        document.getElementById('agent-avatar').innerText = esAle ? "AM" : "MA";
        renderTimer();
    }

    function renderTimer() {
        const w = document.getElementById('status-widget');
        if(!user.deliveryDate) { w.innerHTML = "CITA PENDIENTE"; return; }
        w.innerHTML = `<div style="font-size:9px; font-weight:800; letter-spacing:1.5px; margin-bottom:10px; opacity:0.7;">TIEMPO PARA EL ESTRENO</div>
            <div class="timer-grid">
                <div class="time-unit"><div id="d-days">0</div><div>D√çAS</div></div>
                <div class="time-unit"><div id="d-hours">0</div><div>HRS</div></div>
                <div class="time-unit"><div id="d-mins">0</div><div>MIN</div></div>
                <div class="time-unit"><div id="d-secs">0</div><div>SEG</div></div>
            </div>`;
        if(window.tInt) clearInterval(window.tInt);
        window.tInt = setInterval(updateTimer, 1000);
        updateTimer();
    }

    function updateTimer() {
        const diff = new Date(user.deliveryDate).getTime() - new Date().getTime();
        if(diff <= 0) { document.getElementById('status-widget').innerHTML = "¬°HOY ES EL D√çA! üöó"; return; }
        document.getElementById('d-days').innerText = Math.floor(diff / 86400000);
        document.getElementById('d-hours').innerText = Math.floor((diff % 86400000) / 3600000);
        document.getElementById('d-mins').innerText = Math.floor((diff % 3600000) / 60000);
        document.getElementById('d-secs').innerText = Math.floor((diff % 60000) / 1000);
    }

    function reveal() { 
        document.getElementById('cover').classList.add('open'); 
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#00B0F0', '#FFFFFF', '#001E50'] });
    }
    
    function toggleCheck(e) { e.classList.toggle('checked'); }
    function showToast(t, time = 3000) { var x = document.getElementById("toast"); x.className = "show"; x.innerText = t; setTimeout(()=>x.className="", time); }
    
    function notifyChecklist() { 
        const btn = document.getElementById('notifyBtn');
        btn.style.background = "#25D366"; btn.style.color = "white";
        btn.innerHTML = '<i class="fas fa-check-circle"></i> ASESOR AVISADO';
        var t = user.agente.includes("ALEJANDRO") ? "34618969208" : "34660050228";
        setTimeout(() => { window.open("https://wa.me/"+t+"?text=Todo listo para la entrega."); }, 800);
    }

    function whatsappMe() { var t = user.agente.includes("ALEJANDRO") ? "34618969208" : "34660050228"; window.open("https://wa.me/"+t); }
    function notifyArrival() { var t = user.agente.includes("ALEJANDRO") ? "34618969208" : "34660050228"; window.open("https://wa.me/"+t+"?text=Ya estoy aqu√≠."); }
    function sendWishlist() { window.open("https://wa.me/34660050228?text=Inter√©s accesorio: " + document.getElementById('wishlist').value); }
</script>
</body>
</html>
